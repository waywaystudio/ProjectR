using Common.Skills;
using UnityEngine;

namespace Character.Venturers.Warrior.Skills
{
    public class Exploitation : SkillComponent
    {
        public override void Initialize()
        {
            base.Initialize();

            SequenceBuilder.Add(SectionType.Execute, "CommonExecution", ExecuteExploitation);
        }


        private void ExecuteExploitation()
        {
            var takers = detector.GetTakers();

            if (takers.IsNullOrEmpty() || !takers[0].DynamicStatEntry.Alive.Value) return;

            detector.GetTakers()?.ForEach(executor.Execute);
            
            // Clamp
            var maxHp = Cb.StatTable.MaxHp;
            var damagedHp = maxHp - Cb.DynamicStatEntry.Hp.Value;
            var drainAmount = Mathf.Min(maxHp * 0.05f, damagedHp);
            
            Cb.DynamicStatEntry.Hp.Value += drainAmount;
        }
    }
}
