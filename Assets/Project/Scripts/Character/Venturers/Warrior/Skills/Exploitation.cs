using Common.Characters;
using Common.Skills;
using UnityEngine;

namespace Character.Venturers.Warrior.Skills
{
    public class Exploitation : SkillComponent
    {
        public override void Initialize()
        {
            base.Initialize();

            Builder
                .Add(Section.Execute, "CommonExecution", ExecuteExploitation);
        }


        private void ExecuteExploitation()
        {
            detector.GetTakers()?.ForEach(taker =>
            {
                Taker = taker;
                Invoker.Hit(taker);
            });
            
            // Clamp
            var maxHp = Cb.StatTable.MaxHp;
            var damagedHp = maxHp - Cb.Hp.Value;
            var drainAmount = Mathf.Min(maxHp * 0.05f, damagedHp);
            
            Cb.Hp.Value += drainAmount;
        }
    }
}
